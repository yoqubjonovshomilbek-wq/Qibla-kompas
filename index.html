<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Islomiy Ilova</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Nunito:wght@400;600;700;800&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
:root{
  --g:#1db954;--gd:#158f3e;--gold:#d4a843;
  --bg:#0a0f1a;--s1:#0b1e35;--s2:#102840;--s3:#163450;
  --bdr:rgba(29,185,84,0.18);--tx:#e8f4fd;--mt:#567a96;
  --gw:rgba(29,185,84,0.4);
}
html,body{height:100%;overflow:hidden;}
body{font-family:'Tajawal',sans-serif;background:var(--bg);color:var(--tx);
  display:flex;flex-direction:column;height:100dvh;}
.stars{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
.star{position:absolute;border-radius:50%;background:#fff;opacity:0;animation:tw var(--d) ease-in-out infinite var(--dl)}
@keyframes tw{0%,100%{opacity:0}50%{opacity:.65}}

/* NAV */
.nav{display:flex;background:var(--s1);border-bottom:1px solid var(--bdr);flex-shrink:0;z-index:50;}
.nb{flex:1;padding:11px 6px 9px;border:none;background:transparent;color:var(--mt);
  font-family:'Tajawal',sans-serif;font-size:11px;font-weight:500;cursor:pointer;
  display:flex;flex-direction:column;align-items:center;gap:3px;position:relative;transition:color .2s;}
.nb .ni{font-size:20px;}.nb.on{color:var(--g);}
.nb::after{content:'';position:absolute;bottom:0;left:20%;right:20%;height:2px;
  border-radius:2px 2px 0 0;background:var(--g);transform:scaleX(0);transition:transform .2s;}
.nb.on::after{transform:scaleX(1);}
.pages{flex:1;position:relative;overflow:hidden;}
.pg{position:absolute;inset:0;overflow-y:auto;overflow-x:hidden;
  -webkit-overflow-scrolling:touch;opacity:0;pointer-events:none;transition:opacity .2s;}
.pg.on{opacity:1;pointer-events:all;}
.pg::-webkit-scrollbar{width:3px;}
.pg::-webkit-scrollbar-thumb{background:var(--s3);border-radius:3px;}

/* â•â•â•â•â•â•â•â•â•â• TAB 1: QIBLA â•â•â•â•â•â•â•â•â•â• */
#pg0{display:flex;flex-direction:column;align-items:center;padding-bottom:24px;}
.qstatus{z-index:10;display:flex;align-items:center;gap:7px;padding:10px 0 4px}
.qdot{width:8px;height:8px;border-radius:50%;background:#3a4455;transition:all .4s}
.qdot.on{background:#22c55e;box-shadow:0 0 8px rgba(34,197,94,.6);animation:pd 1.8s infinite}
@keyframes pd{0%,100%{transform:scale(1)}50%{transform:scale(1.3)}}
.qstxt{font-size:11px;color:#6b7685;font-weight:700;letter-spacing:1px}
.qcwrap{z-index:10;position:relative;display:flex;align-items:center;justify-content:center;margin:4px 0 8px}
.qgring{position:absolute;border-radius:50%;width:306px;height:306px;
  box-shadow:0 0 38px 5px rgba(34,197,94,.1);transition:box-shadow .7s;pointer-events:none;}
.qgring.on{box-shadow:0 0 65px 22px rgba(34,197,94,.55),0 0 120px 45px rgba(34,197,94,.22);animation:qgp 1.1s ease-in-out infinite;}
@keyframes qgp{0%,100%{box-shadow:0 0 65px 22px rgba(34,197,94,.55),0 0 120px 45px rgba(34,197,94,.22)}50%{box-shadow:0 0 85px 32px rgba(34,197,94,.75),0 0 160px 65px rgba(34,197,94,.3)}}
#qcv{width:295px;height:295px;border-radius:50%;display:block}
.qkaaba{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
  width:58px;height:58px;border-radius:50%;
  background:radial-gradient(circle at 38% 32%,#42a5f5,#0d47a1);
  display:flex;align-items:center;justify-content:center;font-size:28px;z-index:20;
  box-shadow:0 0 0 3px rgba(255,255,255,.12),0 4px 18px rgba(0,0,0,.55);transition:box-shadow .5s;}
.qkaaba.on{box-shadow:0 0 0 4px #22c55e,0 0 24px rgba(34,197,94,.65)}
.qdegwrap{z-index:10;text-align:center;margin-bottom:8px}
.qdval{font-family:'Nunito',sans-serif;font-size:52px;font-weight:800;color:#e8edf5;letter-spacing:-2px;line-height:1;transition:color .5s}
.qdval.on{color:#22c55e}
.qddir{font-size:13px;color:#6b7685;letter-spacing:2px;font-weight:700;text-transform:uppercase;margin-top:2px}
.qbadge{display:inline-block;background:#121826;border:1px solid rgba(255,255,255,.07);border-radius:20px;padding:5px 14px;font-size:12px;color:#6b7685;margin-top:5px;}
.qbadge b{color:#f0c040;font-weight:700}
.qloccard{z-index:10;width:calc(100% - 32px);max-width:340px;background:#131922;border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:13px 16px;display:flex;align-items:center;gap:12px;margin-bottom:10px;}
.qlocico{width:38px;height:38px;border-radius:12px;background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.2);display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.qlocname{font-size:14px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.qloccoords{font-size:11px;color:#6b7685;margin-top:1px}
.qbanner{z-index:10;width:calc(100% - 32px);max-width:340px;background:linear-gradient(135deg,rgba(34,197,94,.16),rgba(34,197,94,.05));border:1px solid rgba(34,197,94,.35);border-radius:14px;padding:12px 16px;display:flex;align-items:center;gap:10px;opacity:0;transform:translateY(8px);transition:opacity .5s,transform .5s;}
.qbanner.show{opacity:1;transform:translateY(0)}
.qbt{font-size:14px;font-weight:800;color:#22c55e}.qbs{font-size:11px;color:#6b7685}
.qdbg{z-index:10;width:calc(100% - 32px);max-width:340px;background:#0f1520;border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:10px 14px;margin-top:8px;font-size:11px;color:#6b7685;line-height:1.8;display:none;}
.qdbg.show{display:block}

/* Loading */
.qls{position:fixed;inset:0;background:#0a0f1a;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:300;gap:14px;transition:opacity .6s;}
.qls.hide{opacity:0;pointer-events:none}
.qlic{font-size:60px;animation:qflI 2.2s ease-in-out infinite}
@keyframes qflI{0%,100%{transform:translateY(0) rotate(-3deg)}50%{transform:translateY(-13px) rotate(3deg)}}
.qspin{width:34px;height:34px;border-radius:50%;border:3px solid rgba(255,255,255,.08);border-top-color:#22c55e;animation:qsp .8s linear infinite}
@keyframes qsp{to{transform:rotate(360deg)}}
.qlsub{font-size:12px;color:rgba(107,118,133,.85);text-align:center;max-width:280px;line-height:1.6}
.qpbtn{background:linear-gradient(135deg,#22c55e,#15803d);border:none;color:#fff;padding:14px 32px;border-radius:50px;font-size:15px;font-family:inherit;font-weight:800;cursor:pointer;box-shadow:0 4px 22px rgba(34,197,94,.4);letter-spacing:.5px;}
.qpbtn:active{transform:scale(.96)}
@keyframes qflash{0%,100%{background:#0a0f1a}45%{background:rgba(34,197,94,.07)}}
body.qfl{animation:qflash .7s ease}

/* â•â•â•â•â•â•â•â•â•â• TAB 2: QUR'ON â•â•â•â•â•â•â•â•â•â• */
.qrp{display:flex;flex-direction:column;}
.qhdr{padding:13px 13px 9px;background:var(--s1);border-bottom:1px solid var(--bdr);position:sticky;top:0;z-index:10;}
.qhdr h2{font-family:'Amiri',serif;font-size:20px;color:var(--gold);text-shadow:0 0 12px rgba(212,168,67,.3);text-align:center;margin-bottom:8px;}
.sbox{position:relative;}
.sbox input{width:100%;background:var(--s2);border:1.5px solid var(--bdr);border-radius:10px;padding:9px 12px 9px 36px;color:var(--tx);font-family:'Tajawal',sans-serif;font-size:13px;outline:none;}
.sbox input:focus{border-color:var(--g);}
.sbox input::placeholder{color:var(--mt);}
.sbico{position:absolute;left:11px;top:50%;transform:translateY(-50%);font-size:14px;pointer-events:none;}
.rcrow{display:flex;gap:6px;margin-top:8px;overflow-x:auto;padding-bottom:2px;}
.rcrow::-webkit-scrollbar{display:none;}
.rchip{flex-shrink:0;padding:5px 12px;border-radius:20px;border:1.5px solid var(--bdr);background:var(--s2);color:var(--mt);font-size:11px;cursor:pointer;transition:all .2s;font-family:'Tajawal',sans-serif;white-space:nowrap;}
.rchip.on{background:rgba(29,185,84,.15);border-color:var(--g);color:var(--g);}
.slist{padding:8px 10px 160px;}
.si2{display:flex;align-items:center;gap:10px;padding:10px 11px;border-radius:11px;background:var(--s1);border:1px solid var(--bdr);margin-bottom:5px;cursor:pointer;transition:background .15s;position:relative;overflow:hidden;}
.si2.pl{background:rgba(29,185,84,.1);border-color:var(--g);}
.si2::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--g);transform:scaleY(0);transition:transform .2s;border-radius:0 2px 2px 0;}
.si2.pl::before{transform:scaleY(1);}
.sno{width:32px;height:32px;background:var(--s2);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--g);flex-shrink:0;border:1px solid var(--bdr);}
.si2.pl .sno{background:var(--g);color:#fff;border-color:var(--g);}
.sinf{flex:1;min-width:0;}
.sar{font-family:'Amiri',serif;font-size:15px;color:var(--tx);}
.suz{font-size:10px;color:var(--mt);margin-top:1px;}
.smeta{font-size:10px;color:var(--mt);text-align:right;flex-shrink:0;line-height:1.5;}
.pbtn{width:32px;height:32px;border-radius:50%;background:var(--s2);border:1px solid var(--bdr);display:flex;align-items:center;justify-content:center;font-size:12px;flex-shrink:0;}
.si2.pl .pbtn{background:var(--g);border-color:var(--g);}
.nores{text-align:center;padding:40px 20px;color:var(--mt);font-size:13px;}

/* Player */
.player{position:fixed;bottom:0;left:0;right:0;background:linear-gradient(0deg,#081828 0%,rgba(11,30,53,.99) 100%);border-top:1px solid var(--bdr);padding:10px 14px 20px;z-index:200;transform:translateY(100%);transition:transform .3s cubic-bezier(.4,0,.2,1);box-shadow:0 -8px 30px rgba(0,0,0,.7);}
.player.vis{transform:translateY(0);}
.pinfo{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:6px;}
.ptit{font-family:'Amiri',serif;font-size:15px;color:var(--gold);}
.psub{font-size:10px;color:var(--mt);margin-top:2px;}
.pcls{background:none;border:none;color:var(--mt);font-size:18px;cursor:pointer;padding:2px 6px;}
.prow{display:flex;align-items:center;gap:8px;margin-bottom:8px;}
.ptm{font-size:11px;color:var(--mt);min-width:30px;font-variant-numeric:tabular-nums;}
.pbar{flex:1;height:5px;background:var(--s3);border-radius:5px;cursor:pointer;}
.pfil{height:100%;background:var(--g);border-radius:5px;width:0%;transition:width .25s linear;pointer-events:none;}
.pctrls{display:flex;align-items:center;justify-content:center;gap:20px;}
.cbtn{background:none;border:none;color:var(--mt);font-size:22px;cursor:pointer;padding:4px;}
.ppbtn{width:50px;height:50px;border-radius:50%;background:var(--g);border:none;display:flex;align-items:center;justify-content:center;font-size:22px;cursor:pointer;box-shadow:0 4px 15px var(--gw);transition:transform .1s;}
.ppbtn:active{transform:scale(.92);}
.pmsg{font-size:11px;color:var(--mt);text-align:center;margin-top:5px;min-height:16px;line-height:1.4;}
.pmsg.err{color:#e74c3c;}

/* â•â•â•â•â•â•â•â•â•â• TAB 3: NAMOZ â•â•â•â•â•â•â•â•â•â• */
#pg2{display:flex;flex-direction:column;padding-bottom:30px;}
.nhdr{padding:14px 14px 10px;background:var(--s1);border-bottom:1px solid var(--bdr);position:sticky;top:0;z-index:10;flex-shrink:0;}
.nhdr h2{font-family:'Amiri',serif;font-size:20px;color:var(--gold);text-align:center;text-shadow:0 0 12px rgba(212,168,67,.3);}
/* Category tabs */
.ncats{display:flex;gap:0;background:var(--s2);border-radius:12px;margin:10px 14px 0;padding:3px;border:1px solid var(--bdr);}
.ncat{flex:1;padding:8px 4px;border:none;background:transparent;color:var(--mt);font-family:'Tajawal',sans-serif;font-size:12px;font-weight:600;cursor:pointer;border-radius:9px;transition:all .2s;text-align:center;}
.ncat.on{background:var(--g);color:#fff;box-shadow:0 2px 10px rgba(29,185,84,.4);}
/* Content area */
.ncontent{flex:1;overflow-y:auto;padding:0 14px 20px;}

/* Section title */
.nsectitle{font-family:'Amiri',serif;font-size:17px;color:var(--gold);margin:16px 0 10px;text-align:center;}
/* Step card */
.nstep{background:var(--s1);border:1px solid var(--bdr);border-radius:14px;margin-bottom:10px;overflow:hidden;}
.nstep-hd{display:flex;align-items:center;gap:10px;padding:12px 14px;cursor:pointer;}
.nstep-num{width:32px;height:32px;border-radius:50%;background:rgba(29,185,84,.15);border:1.5px solid rgba(29,185,84,.4);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;color:var(--g);flex-shrink:0;}
.nstep-ico{font-size:22px;flex-shrink:0;}
.nstep-ttl{flex:1;font-size:14px;font-weight:700;color:var(--tx);}
.nstep-arr{color:var(--mt);font-size:14px;transition:transform .2s;}
.nstep.open .nstep-arr{transform:rotate(180deg);}
.nstep-body{max-height:0;overflow:hidden;transition:max-height .35s ease;}
.nstep.open .nstep-body{max-height:600px;}
.nstep-inner{padding:0 14px 14px;}
.nstep-ar{font-family:'Amiri',serif;font-size:22px;direction:rtl;text-align:center;color:#c8d8e8;line-height:1.7;margin-bottom:8px;padding:10px;background:rgba(0,0,0,.2);border-radius:10px;}
.nstep-uz{font-size:13px;color:var(--mt);line-height:1.7;margin-bottom:6px;}
.nstep-desc{font-size:12px;color:#3d5a72;line-height:1.6;border-top:1px solid var(--bdr);padding-top:8px;margin-top:4px;}

/* Prayer cards */
.nprayer{background:var(--s1);border:1px solid var(--bdr);border-radius:14px;margin-bottom:12px;overflow:hidden;}
.nprayer-hd{display:flex;align-items:center;gap:12px;padding:14px;cursor:pointer;}
.nprayer-ico{font-size:28px;}
.nprayer-info{flex:1;}
.nprayer-name{font-family:'Amiri',serif;font-size:18px;color:var(--gold);}
.nprayer-sub{font-size:11px;color:var(--mt);margin-top:2px;}
.nprayer-rakat{background:rgba(29,185,84,.12);border:1px solid rgba(29,185,84,.3);border-radius:20px;padding:4px 10px;font-size:11px;color:var(--g);font-weight:700;white-space:nowrap;}
.nprayer-arr{color:var(--mt);font-size:14px;transition:transform .2s;}
.nprayer.open .nprayer-arr{transform:rotate(180deg);}
.nprayer-body{max-height:0;overflow:hidden;transition:max-height .4s ease;}
.nprayer.open .nprayer-body{max-height:2000px;}
.nprayer-inner{padding:0 14px 14px;}

/* Rakat step */
.nrak{display:flex;gap:10px;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.04);}
.nrak:last-child{border-bottom:none;}
.nrak-num{width:26px;height:26px;border-radius:50%;background:var(--s2);border:1px solid var(--bdr);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;color:var(--g);flex-shrink:0;margin-top:1px;}
.nrak-cont{flex:1;}
.nrak-ttl{font-size:13px;font-weight:700;color:var(--tx);margin-bottom:4px;}
.nrak-ar{font-family:'Amiri',serif;font-size:18px;direction:rtl;color:#a8c0d4;line-height:1.6;margin-bottom:3px;}
.nrak-tr{font-size:11px;color:#4a6a82;font-style:italic;margin-bottom:3px;}
.nrak-uz{font-size:12px;color:var(--mt);line-height:1.5;}

/* Info box */
.ninfo{background:rgba(29,185,84,.06);border:1px solid rgba(29,185,84,.2);border-radius:10px;padding:10px 12px;margin-bottom:10px;font-size:12px;color:#4a8a6a;line-height:1.6;}
.ninfo b{color:var(--g);}
</style>
</head>
<body>
<div class="stars" id="stars"></div>

<!-- Loading overlay -->
<div class="qls" id="QLS">
  <div class="qlic">ğŸ•Œ</div>
  <div style="font-size:18px;font-weight:800;color:#e8edf5">Islomiy Ilova</div>
  <div id="QLSbody" style="display:flex;flex-direction:column;align-items:center;gap:12px">
    <div class="qspin"></div>
    <div class="qlsub" id="QLSmsg">Yuklanmoqda...</div>
  </div>
  <button class="qpbtn" id="qpbtn" style="display:none" onclick="onPermBtn()">ğŸ“ Ruxsat berish</button>
</div>

<nav class="nav">
  <button class="nb on" id="nb0" onclick="goTab(0)"><span class="ni">ğŸ§­</span><span>Qibla</span></button>
  <button class="nb" id="nb1" onclick="goTab(1)"><span class="ni">ğŸ“–</span><span>Qur'on</span></button>
  <button class="nb" id="nb2" onclick="goTab(2)"><span class="ni">ğŸ¤²</span><span>Namoz</span></button>
</nav>

<div class="pages">

  <!-- â•â• TAB 1: QIBLA â•â• -->
  <div class="pg on" id="pg0">
    <div class="qstatus">
      <div class="qdot" id="qdot"></div>
      <div class="qstxt" id="qstxt">Sensor kutilmoqda...</div>
    </div>
    <div class="qcwrap">
      <div class="qgring" id="qgring"></div>
      <canvas id="qcv" width="590" height="590"></canvas>
      <div class="qkaaba" id="qkaaba">ğŸ•‹</div>
    </div>
    <div class="qdegwrap">
      <div class="qdval" id="qdval">--Â°</div>
      <div class="qddir" id="qddir">Yuklanmoqda</div>
      <div class="qbadge">Qibla: <b id="qqbdg">--Â°</b></div>
    </div>
    <div class="qloccard">
      <div class="qlocico">ğŸ“</div>
      <div style="min-width:0;flex:1">
        <div class="qlocname" id="qlname">Joylashuv aniqlanmoqda...</div>
        <div class="qloccoords" id="qlcoords"></div>
      </div>
    </div>
    <div class="qbanner" id="qbanner">
      <div style="font-size:22px">âœ¨</div>
      <div>
        <div class="qbt">Qibla topildi!</div>
        <div class="qbs">Siz to'g'ri yo'nalishdasiz â€” Alloh qabul qilsin</div>
      </div>
    </div>
    <div class="qdbg" id="qdbg"></div>
  </div>

  <!-- â•â• TAB 2: QUR'ON â•â• -->
  <div class="pg qrp" id="pg1">
    <div class="qhdr">
      <h2>ğŸ“– Qur'oni Karim</h2>
      <div class="sbox"><span class="sbico">ğŸ”</span>
        <input id="srch" type="text" placeholder="Sura nomi yoki raqami..." oninput="doFilter()">
      </div>
      <div class="rcrow" id="rcrow"></div>
    </div>
    <div class="slist" id="slist"></div>
  </div>

  <!-- â•â• TAB 3: NAMOZ â•â• -->
  <div class="pg" id="pg2">
    <div class="nhdr">
      <h2>ğŸ¤² Namoz O'rgatish</h2>
      <div class="ncats">
        <button class="ncat on" id="nc0" onclick="nTab(0)">ğŸ’§ Tahorat</button>
        <button class="ncat" id="nc1" onclick="nTab(1)">ğŸ•Œ 5 Vaqt</button>
      </div>
    </div>
    <div class="ncontent" id="ncontent"></div>
  </div>

</div>

<!-- Audio Player -->
<div class="player" id="player">
  <div class="pinfo">
    <div><div class="ptit" id="ptit">â€”</div><div class="psub" id="psub">â€”</div></div>
    <button class="pcls" onclick="closePlayer()">âœ•</button>
  </div>
  <div class="prow">
    <span class="ptm" id="tc">0:00</span>
    <div class="pbar" id="pbar" onclick="seekAudio(event)"><div class="pfil" id="pfil"></div></div>
    <span class="ptm" id="td">--:--</span>
  </div>
  <div class="pctrls">
    <button class="cbtn" onclick="moveSurah(-1)">â®</button>
    <button class="ppbtn" id="ppbtn" onclick="togglePlay()">â–¶</button>
    <button class="cbtn" onclick="moveSurah(1)">â­</button>
  </div>
  <div class="pmsg" id="pmsg"></div>
</div>
<audio id="au" preload="none"></audio>

<script>
'use strict';

/* â”€â”€ TAB â”€â”€ */
function goTab(i){
  [0,1,2].forEach(j=>{
    document.getElementById('nb'+j).classList.toggle('on',j===i);
    document.getElementById('pg'+j).classList.toggle('on',j===i);
  });
}

/* â”€â”€ STARS â”€â”€ */
(()=>{
  const c=document.getElementById('stars');
  for(let i=0;i<75;i++){
    const s=document.createElement('div');s.className='star';
    const z=Math.random()<.25?3:Math.random()<.5?2:1;
    s.style.cssText=`width:${z}px;height:${z}px;left:${Math.random()*100}%;top:${Math.random()*100}%;--d:${1.8+Math.random()*5}s;--dl:-${Math.random()*7}s`;
    c.appendChild(s);
  }
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QIBLA COMPASS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const KA_LAT=21.4225,KA_LON=39.8262;
let userLat=41.2995,userLon=69.2401;
let qiblaTrue=0,curHead=0,tgtHead=0,firstReading=false;
let sensorOK=false,prevAligned=false,kaabaClicks=0;
let permBtnAction=null;

function calcQibla(lat,lon){
  const toR=d=>d*Math.PI/180;
  const Ï†1=toR(lat),Ï†2=toR(KA_LAT),Î”Î»=toR(KA_LON-lon);
  const y=Math.sin(Î”Î»)*Math.cos(Ï†2);
  const x=Math.cos(Ï†1)*Math.sin(Ï†2)-Math.sin(Ï†1)*Math.cos(Ï†2)*Math.cos(Î”Î»);
  return norm(Math.atan2(y,x)*180/Math.PI);
}
function norm(a){return((a%360)+360)%360;}
function lerpAng(cur,tgt,t){let d=tgt-cur;while(d>180)d-=360;while(d<-180)d+=360;return cur+d*t;}
function isAligned(){let d=qiblaTrue-norm(curHead);while(d>180)d-=360;while(d<-180)d+=360;return Math.abs(d)<5;}
function cardDir(deg){return['Shimol','Shim-Sharq','Sharq','Jan-Sharq','Janub','Jan-GÊ»arb','GÊ»arb','Shim-GÊ»arb'][Math.round(norm(deg)/45)%8];}

const qcv=document.getElementById('qcv'),ctx=qcv.getContext('2d'),SZ=590,CX=295,CY=295;

function drawCompass(heading){
  ctx.clearRect(0,0,SZ,SZ);
  const aln=isAligned();
  const rim=ctx.createLinearGradient(0,0,SZ,SZ);
  if(aln){rim.addColorStop(0,'#4ade80');rim.addColorStop(1,'#16a34a');}
  else{rim.addColorStop(0,'#22c55e');rim.addColorStop(1,'#0b5e22');}
  ctx.beginPath();ctx.arc(CX,CY,287,0,Math.PI*2);ctx.fillStyle=rim;ctx.fill();
  const face=ctx.createRadialGradient(CX,CY,50,CX,CY,255);
  face.addColorStop(0,'#1a2030');face.addColorStop(1,'#0a0f1a');
  ctx.beginPath();ctx.arc(CX,CY,257,0,Math.PI*2);ctx.fillStyle=face;
  ctx.shadowColor=aln?'rgba(34,197,94,.28)':'transparent';ctx.shadowBlur=aln?32:0;ctx.fill();ctx.shadowBlur=0;
  ctx.save();ctx.translate(CX,CY);ctx.rotate(-heading*Math.PI/180);
  for(let i=0;i<360;i++){
    const rad=i*Math.PI/180,maj=i%30===0,med=i%10===0&&!maj,len=maj?25:med?15:8,r1=250;
    ctx.beginPath();ctx.moveTo(Math.cos(rad)*r1,Math.sin(rad)*r1);ctx.lineTo(Math.cos(rad)*(r1-len),Math.sin(rad)*(r1-len));
    ctx.strokeStyle=maj?'rgba(255,255,255,.88)':med?'rgba(255,255,255,.35)':'rgba(255,255,255,.11)';ctx.lineWidth=maj?2.6:1.6;ctx.stroke();
  }
  ctx.font='600 17px Nunito,sans-serif';ctx.fillStyle='rgba(190,205,225,.62)';ctx.textAlign='center';ctx.textBaseline='middle';
  for(let i=0;i<360;i+=30){if(i%90===0)continue;const rad=i*Math.PI/180;ctx.save();ctx.translate(Math.sin(rad)*182,-Math.cos(rad)*182);ctx.rotate(rad);ctx.fillText(i,0,0);ctx.restore();}
  const CARDS=['N','E','S','W'];ctx.font='bold 37px Nunito,sans-serif';
  for(let i=0;i<4;i++){const rad=i*Math.PI/2;ctx.fillStyle=i===0?'#ef4444':'rgba(255,255,255,.84)';ctx.fillText(CARDS[i],Math.sin(rad)*210,-Math.cos(rad)*210);}
  ctx.font='bold 15px Nunito,sans-serif';ctx.fillStyle='rgba(255,255,255,.28)';
  ['NE','SE','SW','NW'].forEach((t,i)=>{const rad=(i*90+45)*Math.PI/180;ctx.fillText(t,Math.sin(rad)*203,-Math.cos(rad)*203);});
  ctx.restore();
  const nd=norm(qiblaTrue-heading),nr=nd*Math.PI/180,nx=Math.sin(nr),ny=-Math.cos(nr);
  ctx.save();ctx.translate(CX,CY);
  const tg=ctx.createLinearGradient(0,0,nx*240,ny*240);
  tg.addColorStop(0,'rgba(240,192,64,0)');tg.addColorStop(.55,'rgba(240,192,64,.12)');tg.addColorStop(1,'rgba(240,192,64,.48)');
  ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(nx*240,ny*240);ctx.strokeStyle=tg;ctx.lineWidth=14;ctx.stroke();
  const arcH=0.115,arcB=nr-Math.PI/2;
  ctx.beginPath();ctx.arc(0,0,265,arcB-arcH,arcB+arcH);ctx.strokeStyle='rgba(240,192,64,.78)';ctx.lineWidth=18;ctx.stroke();
  ctx.save();ctx.rotate(nr);ctx.shadowColor='rgba(240,192,64,.85)';ctx.shadowBlur=22;
  ctx.beginPath();ctx.moveTo(0,-247);ctx.lineTo(13,-212);ctx.lineTo(0,-223);ctx.lineTo(-13,-212);ctx.closePath();ctx.fillStyle='#f0c040';ctx.fill();
  ctx.beginPath();ctx.moveTo(6,-212);ctx.lineTo(5,-128);ctx.lineTo(-5,-128);ctx.lineTo(-6,-212);ctx.closePath();ctx.fillStyle='rgba(240,192,64,.58)';ctx.fill();
  ctx.shadowBlur=0;ctx.restore();ctx.restore();
  if(aln){const p=(Math.sin(Date.now()/270)+1)/2;ctx.beginPath();ctx.arc(CX,CY,257,0,Math.PI*2);ctx.strokeStyle=`rgba(34,197,94,${.28+p*.52})`;ctx.lineWidth=7;ctx.stroke();}
  ctx.save();ctx.translate(CX,CY);ctx.shadowColor='#22c55e';ctx.shadowBlur=14;
  ctx.beginPath();ctx.moveTo(0,-263);ctx.lineTo(9,-243);ctx.lineTo(-9,-243);ctx.closePath();ctx.fillStyle='#22c55e';ctx.fill();ctx.shadowBlur=0;ctx.restore();
}

function qLoop(){
  curHead=lerpAng(curHead,tgtHead,0.12);curHead=norm(curHead);drawCompass(curHead);
  const aln=isAligned(),hd=Math.round(norm(curHead));
  const dv=document.getElementById('qdval');dv.textContent=hd+'Â°';dv.classList.toggle('on',aln);
  document.getElementById('qddir').textContent=cardDir(curHead);
  document.getElementById('qgring').classList.toggle('on',aln);
  document.getElementById('qkaaba').classList.toggle('on',aln);
  document.getElementById('qbanner').classList.toggle('show',aln);
  const dbg=document.getElementById('qdbg');
  if(dbg.classList.contains('show'))dbg.innerHTML=`tgt:<b>${tgtHead.toFixed(1)}Â°</b> cur:<b>${curHead.toFixed(1)}Â°</b> qibla:<b>${qiblaTrue.toFixed(1)}Â°</b> GPS:<b>${userLat.toFixed(3)},${userLon.toFixed(3)}</b>`;
  if(aln&&!prevAligned&&sensorOK){document.body.classList.add('qfl');setTimeout(()=>document.body.classList.remove('qfl'),750);if(navigator.vibrate)navigator.vibrate([65,45,100]);}
  prevAligned=aln;requestAnimationFrame(qLoop);
}

function onHeading(h){
  if(!firstReading){curHead=h;firstReading=true;}tgtHead=h;
  if(!sensorOK){sensorOK=true;document.getElementById('qdot').classList.add('on');document.getElementById('qstxt').textContent='Kompas faol âœ“';hideLoading();}
}
function onOrient(e){
  if(typeof e.webkitCompassHeading==='number'&&!isNaN(e.webkitCompassHeading)&&e.webkitCompassHeading>=0){onHeading(e.webkitCompassHeading);return;}
  if(typeof e.alpha==='number'&&e.alpha!==null)onHeading(norm(360-e.alpha));
}
function addOrientListeners(){window.addEventListener('deviceorientationabsolute',onOrient,true);window.addEventListener('deviceorientation',onOrient,true);}
function tryGenericSensor(){
  if(typeof AbsoluteOrientationSensor==='undefined')return false;
  try{
    Promise.all([navigator.permissions.query({name:'accelerometer'}),navigator.permissions.query({name:'magnetometer'}),navigator.permissions.query({name:'gyroscope'})])
      .then(rs=>{if(rs.every(r=>r.state!=='denied')){const s=new AbsoluteOrientationSensor({frequency:30,referenceFrame:'screen'});s.addEventListener('reading',()=>{try{const[x,y,z,w]=s.quaternion;onHeading(norm(Math.atan2(2*(w*z+x*y),1-2*(y*y+z*z))*180/Math.PI));}catch(_){}});s.addEventListener('error',()=>addOrientListeners());s.start();}else addOrientListeners();})
      .catch(()=>addOrientListeners());return true;
  }catch(e){return false;}
}
const isIOS=()=>typeof DeviceOrientationEvent!=='undefined'&&typeof DeviceOrientationEvent.requestPermission==='function';
function requestSensor(){
  if(isIOS()){DeviceOrientationEvent.requestPermission().then(st=>{if(st==='granted')addOrientListeners();else setLoadMsg('Kompas ruxsati rad etildi.');}).catch(e=>setLoadMsg('Xato: '+e.message));}
  else{if(!tryGenericSensor())addOrientListeners();}
}
function onPermBtn(){if(permBtnAction)permBtnAction();}
function setLoadMsg(msg){document.getElementById('QLSmsg').innerHTML=msg;}
function showBtn(msg,label,fn){setLoadMsg(msg);const b=document.getElementById('qpbtn');b.textContent=label;b.style.display='block';permBtnAction=fn;}
function hideLoading(){const el=document.getElementById('QLS');el.classList.add('hide');setTimeout(()=>el.style.display='none',700);}

function updateQibla(){qiblaTrue=calcQibla(userLat,userLon);document.getElementById('qqbdg').textContent=Math.round(qiblaTrue)+'Â°';}
function setLocUI(lat,lon,name){document.getElementById('qlname').textContent=name;document.getElementById('qlcoords').textContent=`${lat.toFixed(4)}Â°N, ${lon.toFixed(4)}Â°E`;}
function startGPS(){
  if(!navigator.geolocation){startIPGeo();return;}
  navigator.geolocation.getCurrentPosition(pos=>{userLat=pos.coords.latitude;userLon=pos.coords.longitude;updateQibla();reverseGeo(userLat,userLon);},()=>startIPGeo(),{enableHighAccuracy:true,timeout:10000,maximumAge:0});
}
function startIPGeo(){
  fetch('https://ip-api.com/json/?fields=status,lat,lon,city,country').then(r=>r.json()).then(d=>{
    if(d.status==='success'&&d.lat){userLat=d.lat;userLon=d.lon;updateQibla();setLocUI(userLat,userLon,(d.city||'')+(d.country?', '+d.country:''));}
    else useTashkent();
  }).catch(()=>useTashkent());
}
function useTashkent(){userLat=41.2995;userLon=69.2401;updateQibla();setLocUI(userLat,userLon,"Toshkent, O'zbekiston");}
function reverseGeo(lat,lon){
  setLocUI(lat,lon,'Aniqlanmoqda...');
  fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json&accept-language=uz,en`).then(r=>r.json()).then(d=>{const a=d.address||{};const city=a.city||a.town||a.village||a.state||'';const country=a.country||'';setLocUI(lat,lon,city&&country?`${city}, ${country}`:city||`${lat.toFixed(4)}Â°N`);}).catch(()=>setLocUI(lat,lon,`${lat.toFixed(4)}Â°N`));
}
document.getElementById('qkaaba').addEventListener('click',()=>{kaabaClicks++;if(kaabaClicks>=5){kaabaClicks=0;document.getElementById('qdbg').classList.toggle('show');}});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUR'ON AUDIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const EDITIONS=[{name:'Mishary Alafasy',ed:'ar.alafasy'},{name:'Abdurrahman Sudais',ed:'ar.abdurrahmaansudais'},{name:'Husary',ed:'ar.husary'},{name:'Saad Al-Ghamdi',ed:'ar.saoodshuraym'}];
const SURAHS=[
  {n:1,ar:'Ø§Ù„ÙØ§ØªØ­Ø©',uz:'Al-Fotiha',a:7,t:'Makka'},{n:2,ar:'Ø§Ù„Ø¨Ù‚Ø±Ø©',uz:'Al-Baqara',a:286,t:'Madina'},
  {n:3,ar:'Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†',uz:'Ali Imron',a:200,t:'Madina'},{n:4,ar:'Ø§Ù„Ù†Ø³Ø§Ø¡',uz:'An-Niso',a:176,t:'Madina'},
  {n:5,ar:'Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©',uz:'Al-Moida',a:120,t:'Madina'},{n:6,ar:'Ø§Ù„Ø£Ù†Ø¹Ø§Ù…',uz:"Al-An'om",a:165,t:'Makka'},
  {n:7,ar:'Ø§Ù„Ø£Ø¹Ø±Ø§Ù',uz:"Al-A'rof",a:206,t:'Makka'},{n:8,ar:'Ø§Ù„Ø£Ù†ÙØ§Ù„',uz:'Al-Anfol',a:75,t:'Madina'},
  {n:9,ar:'Ø§Ù„ØªÙˆØ¨Ø©',uz:'At-Tavba',a:129,t:'Madina'},{n:10,ar:'ÙŠÙˆÙ†Ø³',uz:'Yunus',a:109,t:'Makka'},
  {n:11,ar:'Ù‡ÙˆØ¯',uz:'Hud',a:123,t:'Makka'},{n:12,ar:'ÙŠÙˆØ³Ù',uz:'Yusuf',a:111,t:'Makka'},
  {n:13,ar:'Ø§Ù„Ø±Ø¹Ø¯',uz:"Ar-Ra'd",a:43,t:'Madina'},{n:14,ar:'Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…',uz:'Ibrohim',a:52,t:'Makka'},
  {n:15,ar:'Ø§Ù„Ø­Ø¬Ø±',uz:'Al-Hijr',a:99,t:'Makka'},{n:16,ar:'Ø§Ù„Ù†Ø­Ù„',uz:'An-Nahl',a:128,t:'Makka'},
  {n:17,ar:'Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡',uz:'Al-Isro',a:111,t:'Makka'},{n:18,ar:'Ø§Ù„ÙƒÙ‡Ù',uz:'Al-Kahf',a:110,t:'Makka'},
  {n:19,ar:'Ù…Ø±ÙŠÙ…',uz:'Maryam',a:98,t:'Makka'},{n:20,ar:'Ø·Ù‡',uz:'To Ha',a:135,t:'Makka'},
  {n:21,ar:'Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡',uz:'Al-Anbiyo',a:112,t:'Makka'},{n:22,ar:'Ø§Ù„Ø­Ø¬',uz:'Al-Haj',a:78,t:'Madina'},
  {n:23,ar:'Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†',uz:"Al-Mo'minun",a:118,t:'Makka'},{n:24,ar:'Ø§Ù„Ù†ÙˆØ±',uz:'An-Nur',a:64,t:'Madina'},
  {n:25,ar:'Ø§Ù„ÙØ±Ù‚Ø§Ù†',uz:'Al-Furqon',a:77,t:'Makka'},{n:26,ar:'Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡',uz:"Ash-Shu'aro",a:227,t:'Makka'},
  {n:27,ar:'Ø§Ù„Ù†Ù…Ù„',uz:'An-Naml',a:93,t:'Makka'},{n:28,ar:'Ø§Ù„Ù‚ØµØµ',uz:'Al-Qasas',a:88,t:'Makka'},
  {n:29,ar:'Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª',uz:'Al-Ankabut',a:69,t:'Makka'},{n:30,ar:'Ø§Ù„Ø±ÙˆÙ…',uz:'Ar-Rum',a:60,t:'Makka'},
  {n:31,ar:'Ù„Ù‚Ù…Ø§Ù†',uz:'Luqmon',a:34,t:'Makka'},{n:32,ar:'Ø§Ù„Ø³Ø¬Ø¯Ø©',uz:'As-Sajda',a:30,t:'Makka'},
  {n:33,ar:'Ø§Ù„Ø£Ø­Ø²Ø§Ø¨',uz:'Al-Ahzob',a:73,t:'Madina'},{n:34,ar:'Ø³Ø¨Ø£',uz:'Saba',a:54,t:'Makka'},
  {n:35,ar:'ÙØ§Ø·Ø±',uz:'Fotir',a:45,t:'Makka'},{n:36,ar:'ÙŠØ³',uz:'Yo Sin',a:83,t:'Makka'},
  {n:37,ar:'Ø§Ù„ØµØ§ÙØ§Øª',uz:'As-Soffot',a:182,t:'Makka'},{n:38,ar:'Øµ',uz:'Sod',a:88,t:'Makka'},
  {n:39,ar:'Ø§Ù„Ø²Ù…Ø±',uz:'Az-Zumar',a:75,t:'Makka'},{n:40,ar:'ØºØ§ÙØ±',uz:"G'ofir",a:85,t:'Makka'},
  {n:41,ar:'ÙØµÙ„Øª',uz:'Fussilat',a:54,t:'Makka'},{n:42,ar:'Ø§Ù„Ø´ÙˆØ±Ù‰',uz:'Ash-Shura',a:53,t:'Makka'},
  {n:43,ar:'Ø§Ù„Ø²Ø®Ø±Ù',uz:'Az-Zukhruf',a:89,t:'Makka'},{n:44,ar:'Ø§Ù„Ø¯Ø®Ø§Ù†',uz:'Ad-Dukhan',a:59,t:'Makka'},
  {n:45,ar:'Ø§Ù„Ø¬Ø§Ø«ÙŠØ©',uz:'Al-Josiya',a:37,t:'Makka'},{n:46,ar:'Ø§Ù„Ø£Ø­Ù‚Ø§Ù',uz:'Al-Ahqof',a:35,t:'Makka'},
  {n:47,ar:'Ù…Ø­Ù…Ø¯',uz:'Muhammad',a:38,t:'Madina'},{n:48,ar:'Ø§Ù„ÙØªØ­',uz:'Al-Fath',a:29,t:'Madina'},
  {n:49,ar:'Ø§Ù„Ø­Ø¬Ø±Ø§Øª',uz:'Al-Hujurot',a:18,t:'Madina'},{n:50,ar:'Ù‚',uz:'Qof',a:45,t:'Makka'},
  {n:51,ar:'Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª',uz:'Az-Zoriyot',a:60,t:'Makka'},{n:52,ar:'Ø§Ù„Ø·ÙˆØ±',uz:'At-Tur',a:49,t:'Makka'},
  {n:53,ar:'Ø§Ù„Ù†Ø¬Ù…',uz:'An-Najm',a:62,t:'Makka'},{n:54,ar:'Ø§Ù„Ù‚Ù…Ø±',uz:'Al-Qamar',a:55,t:'Makka'},
  {n:55,ar:'Ø§Ù„Ø±Ø­Ù…Ù†',uz:'Ar-Rohman',a:78,t:'Madina'},{n:56,ar:'Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©',uz:'Al-Voqia',a:96,t:'Makka'},
  {n:57,ar:'Ø§Ù„Ø­Ø¯ÙŠØ¯',uz:'Al-Hadid',a:29,t:'Madina'},{n:58,ar:'Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©',uz:'Al-Mujodala',a:22,t:'Madina'},
  {n:59,ar:'Ø§Ù„Ø­Ø´Ø±',uz:'Al-Hashr',a:24,t:'Madina'},{n:60,ar:'Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©',uz:'Al-Mumtahana',a:13,t:'Madina'},
  {n:61,ar:'Ø§Ù„ØµÙ',uz:'As-Saff',a:14,t:'Madina'},{n:62,ar:'Ø§Ù„Ø¬Ù…Ø¹Ø©',uz:"Al-Jum'a",a:11,t:'Madina'},
  {n:63,ar:'Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†',uz:'Al-Munofiqun',a:11,t:'Madina'},{n:64,ar:'Ø§Ù„ØªØºØ§Ø¨Ù†',uz:'At-Taghabun',a:18,t:'Madina'},
  {n:65,ar:'Ø§Ù„Ø·Ù„Ø§Ù‚',uz:'At-Talaq',a:12,t:'Madina'},{n:66,ar:'Ø§Ù„ØªØ­Ø±ÙŠÙ…',uz:'At-Tahrim',a:12,t:'Madina'},
  {n:67,ar:'Ø§Ù„Ù…Ù„Ùƒ',uz:'Al-Mulk',a:30,t:'Makka'},{n:68,ar:'Ø§Ù„Ù‚Ù„Ù…',uz:'Al-Qalam',a:52,t:'Makka'},
  {n:69,ar:'Ø§Ù„Ø­Ø§Ù‚Ø©',uz:'Al-Haqqa',a:52,t:'Makka'},{n:70,ar:'Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬',uz:"Al-Ma'orij",a:44,t:'Makka'},
  {n:71,ar:'Ù†ÙˆØ­',uz:'Nuh',a:28,t:'Makka'},{n:72,ar:'Ø§Ù„Ø¬Ù†',uz:'Al-Jin',a:28,t:'Makka'},
  {n:73,ar:'Ø§Ù„Ù…Ø²Ù…Ù„',uz:'Al-Muzzammil',a:20,t:'Makka'},{n:74,ar:'Ø§Ù„Ù…Ø¯Ø«Ø±',uz:'Al-Muddaththir',a:56,t:'Makka'},
  {n:75,ar:'Ø§Ù„Ù‚ÙŠØ§Ù…Ø©',uz:'Al-Qiyoma',a:40,t:'Makka'},{n:76,ar:'Ø§Ù„Ø¥Ù†Ø³Ø§Ù†',uz:'Al-Inson',a:31,t:'Madina'},
  {n:77,ar:'Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª',uz:'Al-Mursalot',a:50,t:'Makka'},{n:78,ar:'Ø§Ù„Ù†Ø¨Ø£',uz:'An-Naba',a:40,t:'Makka'},
  {n:79,ar:'Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª',uz:"An-Nozi'ot",a:46,t:'Makka'},{n:80,ar:'Ø¹Ø¨Ø³',uz:'Abasa',a:42,t:'Makka'},
  {n:81,ar:'Ø§Ù„ØªÙƒÙˆÙŠØ±',uz:'At-Takwir',a:29,t:'Makka'},{n:82,ar:'Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±',uz:'Al-Infitor',a:19,t:'Makka'},
  {n:83,ar:'Ø§Ù„Ù…Ø·ÙÙÙŠÙ†',uz:'Al-Mutaffifin',a:36,t:'Makka'},{n:84,ar:'Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚',uz:'Al-Inshiqoq',a:25,t:'Makka'},
  {n:85,ar:'Ø§Ù„Ø¨Ø±ÙˆØ¬',uz:'Al-Buruj',a:22,t:'Makka'},{n:86,ar:'Ø§Ù„Ø·Ø§Ø±Ù‚',uz:'At-Toriq',a:17,t:'Makka'},
  {n:87,ar:'Ø§Ù„Ø£Ø¹Ù„Ù‰',uz:"Al-A'lo",a:19,t:'Makka'},{n:88,ar:'Ø§Ù„ØºØ§Ø´ÙŠØ©',uz:"Al-G'oshiya",a:26,t:'Makka'},
  {n:89,ar:'Ø§Ù„ÙØ¬Ø±',uz:'Al-Fajr',a:30,t:'Makka'},{n:90,ar:'Ø§Ù„Ø¨Ù„Ø¯',uz:'Al-Balad',a:20,t:'Makka'},
  {n:91,ar:'Ø§Ù„Ø´Ù…Ø³',uz:'Ash-Shams',a:15,t:'Makka'},{n:92,ar:'Ø§Ù„Ù„ÙŠÙ„',uz:'Al-Layl',a:21,t:'Makka'},
  {n:93,ar:'Ø§Ù„Ø¶Ø­Ù‰',uz:'Ad-Duho',a:11,t:'Makka'},{n:94,ar:'Ø§Ù„Ø´Ø±Ø­',uz:'Ash-Sharh',a:8,t:'Makka'},
  {n:95,ar:'Ø§Ù„ØªÙŠÙ†',uz:'At-Tin',a:8,t:'Makka'},{n:96,ar:'Ø§Ù„Ø¹Ù„Ù‚',uz:'Al-Alaq',a:19,t:'Makka'},
  {n:97,ar:'Ø§Ù„Ù‚Ø¯Ø±',uz:'Al-Qadr',a:5,t:'Makka'},{n:98,ar:'Ø§Ù„Ø¨ÙŠÙ†Ø©',uz:'Al-Bayyina',a:8,t:'Madina'},
  {n:99,ar:'Ø§Ù„Ø²Ù„Ø²Ù„Ø©',uz:'Az-Zalzala',a:8,t:'Madina'},{n:100,ar:'Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª',uz:'Al-Odiyot',a:11,t:'Makka'},
  {n:101,ar:'Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©',uz:"Al-Qori'a",a:11,t:'Makka'},{n:102,ar:'Ø§Ù„ØªÙƒØ§Ø«Ø±',uz:'At-Takosur',a:8,t:'Makka'},
  {n:103,ar:'Ø§Ù„Ø¹ØµØ±',uz:'Al-Asr',a:3,t:'Makka'},{n:104,ar:'Ø§Ù„Ù‡Ù…Ø²Ø©',uz:'Al-Humaza',a:9,t:'Makka'},
  {n:105,ar:'Ø§Ù„ÙÙŠÙ„',uz:'Al-Fil',a:5,t:'Makka'},{n:106,ar:'Ù‚Ø±ÙŠØ´',uz:'Quraysh',a:4,t:'Makka'},
  {n:107,ar:'Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†',uz:"Al-Mo'un",a:7,t:'Makka'},{n:108,ar:'Ø§Ù„ÙƒÙˆØ«Ø±',uz:'Al-Kavshar',a:3,t:'Makka'},
  {n:109,ar:'Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†',uz:'Al-Kofirun',a:6,t:'Makka'},{n:110,ar:'Ø§Ù„Ù†ØµØ±',uz:'An-Nasr',a:3,t:'Madina'},
  {n:111,ar:'Ø§Ù„Ù…Ø³Ø¯',uz:'Al-Masad',a:5,t:'Makka'},{n:112,ar:'Ø§Ù„Ø¥Ø®Ù„Ø§Øµ',uz:'Al-Ikhlos',a:4,t:'Makka'},
  {n:113,ar:'Ø§Ù„ÙÙ„Ù‚',uz:'Al-Falaq',a:5,t:'Makka'},{n:114,ar:'Ø§Ù„Ù†Ø§Ø³',uz:'An-Nos',a:6,t:'Makka'},
];

const au=document.getElementById('au');
let edIdx=0,curIdx=null,ayahUrls=[],ayahIdx=0,playing=false,busy=false;
let filtered=[...SURAHS];const apiCache={};
function setMsg(t,err=false){const e=document.getElementById('pmsg');e.textContent=t;e.className='pmsg'+(err?' err':'');}
function setPP(i){document.getElementById('ppbtn').textContent=i;}
function fmtT(s){if(!isFinite(s)||isNaN(s))return'0:00';return`${Math.floor(s/60)}:${String(Math.floor(s%60)).padStart(2,'0')}`;}
async function fetchSurahAyahs(n,ed){const k=`${n}|${ed}`;if(apiCache[k])return apiCache[k];const r=await fetch(`https://api.alquran.cloud/v1/surah/${n}/${ed}`);if(!r.ok)throw new Error('HTTP '+r.status);const j=await r.json();if(j.code!==200)throw new Error('API: '+j.code);return apiCache[k]=j.data.ayahs.map(a=>a.audio);}
async function loadSurah(idx,autoPlay=true){
  if(busy)return;curIdx=idx;ayahIdx=0;ayahUrls=[];playing=false;busy=true;
  const s=SURAHS[idx],ed=EDITIONS[edIdx];
  document.getElementById('ptit').textContent=`${s.n}. ${s.ar} â€” ${s.uz}`;
  document.getElementById('psub').textContent=ed.name;
  document.getElementById('player').classList.add('vis');
  document.getElementById('pfil').style.width='0%';document.getElementById('tc').textContent='0:00';document.getElementById('td').textContent='--:--';
  setPP('â³');setMsg(`${s.uz} yuklanmoqda...`);renderList(filtered);
  try{ayahUrls=await fetchSurahAyahs(s.n,ed.ed);busy=false;setMsg(`${ayahUrls.length} oyat | ${ed.name}`);playAyah(0,autoPlay);}
  catch(e){busy=false;setPP('â–¶');setMsg('âŒ '+e.message,true);renderList(filtered);}
}
function playAyah(idx,auto=true){
  if(idx>=ayahUrls.length){moveSurah(1);return;}
  ayahIdx=idx;au.src=ayahUrls[idx];au.load();setMsg(`${idx+1}/${ayahUrls.length} â€” oyat`);
  if(auto){au.play().then(()=>{playing=true;setPP('â¸');renderList(filtered);}).catch(e=>{setPP('â–¶');setMsg('âŒ '+e.message,true);});}else setPP('â–¶');
}
function togglePlay(){
  if(curIdx===null||busy)return;
  if(playing){au.pause();}else{if(!au.src){playAyah(ayahIdx,true);return;}au.play().then(()=>{playing=true;setPP('â¸');}).catch(e=>setMsg('âŒ '+e.message,true));}
}
function moveSurah(d){if(curIdx===null)return;loadSurah((curIdx+d+SURAHS.length)%SURAHS.length,true);}
function closePlayer(){au.pause();playing=false;curIdx=null;ayahUrls=[];document.getElementById('player').classList.remove('vis');renderList(filtered);}
function seekAudio(e){if(!au.duration)return;const r=document.getElementById('pbar').getBoundingClientRect();au.currentTime=((e.clientX-r.left)/r.width)*au.duration;}
au.addEventListener('playing',()=>{playing=true;setPP('â¸');renderList(filtered);});
au.addEventListener('pause',()=>{playing=false;setPP('â–¶');renderList(filtered);});
au.addEventListener('ended',()=>playAyah(ayahIdx+1,true));
au.addEventListener('timeupdate',()=>{if(!au.duration)return;document.getElementById('pfil').style.width=(au.currentTime/au.duration*100)+'%';document.getElementById('tc').textContent=fmtT(au.currentTime);});
au.addEventListener('durationchange',()=>document.getElementById('td').textContent=fmtT(au.duration));
au.addEventListener('error',()=>{setMsg(`${ayahIdx+1}-oyat xato...`,true);setTimeout(()=>playAyah(ayahIdx+1,true),600);});
function buildRec(){
  const row=document.getElementById('rcrow');
  EDITIONS.forEach((e,i)=>{const b=document.createElement('button');b.className='rchip'+(i===0?' on':'');b.textContent=e.name;b.onclick=()=>{edIdx=i;document.querySelectorAll('.rchip').forEach((c,j)=>c.classList.toggle('on',j===i));if(curIdx!==null)loadSurah(curIdx,playing);};row.appendChild(b);});
}
function renderList(list){
  const el=document.getElementById('slist');
  if(!list.length){el.innerHTML='<div class="nores">ğŸ” Hech narsa topilmadi</div>';return;}
  el.innerHTML='';
  list.forEach(s=>{
    const idx=s.n-1,isCur=curIdx===idx;
    const d=document.createElement('div');d.className='si2'+(isCur?' pl':'');
    d.innerHTML=`<div class="sno">${s.n}</div><div class="sinf"><div class="sar">${s.ar}</div><div class="suz">${s.uz}</div></div><div class="smeta">${s.a} oyat<br><small>${s.t}</small></div><div class="pbtn">${isCur&&playing?'â¸':'â–¶'}</div>`;
    d.onclick=()=>{if(curIdx===idx&&!busy)togglePlay();else loadSurah(idx,true);};el.appendChild(d);
  });
}
function doFilter(){
  const q=document.getElementById('srch').value.toLowerCase().trim();
  filtered=q?SURAHS.filter(s=>s.uz.toLowerCase().includes(q)||s.ar.includes(q)||String(s.n).includes(q)):[...SURAHS];
  renderList(filtered);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAMOZ O'RGATISH DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// Tahorat qadamlari
const TAHORAT=[
  {ico:'ğŸ¤²',ttl:'Niyat qilish',ar:'Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙÙ†Ù’ Ø£ÙØªÙÙˆÙØ¶ÙÙ‘Ø£Ù',uz:'Navaytu an atavazza\'',desc:'Tahorat olishdan oldin yurakda niyat qilish â€” Alloh uchun tahorat olaman, deb ko\'ngildan o\'tkazish. Niyat qilish â€” har bir ibodatning asosidir.'},
  {ico:'ğŸ¤²',ttl:'Bismillah aytish',ar:'Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…Ù°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ’Ù…Ù',uz:'Bismillahir rohmanir rohiym',desc:'Tahoratni Alloh nomi bilan boshlash. Bismillasiz boshlangan tahorat to\'liq hisoblanmaydi degan fikr ham bor.'},
  {ico:'ğŸ‘',ttl:'Qo\'llarni yuvish (3 marta)',ar:'',uz:'',desc:'Bilak bo\'g\'imigacha har ikkala qo\'lni uch marta yuvish. Avval o\'ng qo\'l, keyin chap qo\'l. Barmoqlar orasini ham yuvib chiqish.'},
  {ico:'ğŸ’§',ttl:'Og\'izni chayish (3 marta)',ar:'',uz:'',desc:'Og\'izga suv olib yaxshilab chayish. Ro\'za bo\'lmasa, og\'izning ichiga ham suv yetkazish. Uch marta takrorlash.'},
  {ico:'ğŸ’§',ttl:'Burun yuvish (3 marta)',ar:'',uz:'',desc:'Burunga suv tortib, keyin puflab tashqariga chiqarish. Uch marta takrorlash. Ro\'za bo\'lsa, ehtiyot bo\'lib yuvish.'},
  {ico:'ğŸ«§',ttl:'Yuzni yuvish (3 marta)',ar:'',uz:'',desc:'Peshonadan iyan soqqasigacha va ikki quloq o\'rtasini to\'liq yuvish. Soqol qalin bo\'lsa barmoqlar orasidan suv o\'tkazish.'},
  {ico:'ğŸ’ª',ttl:'Qo\'llarni tirsakkĞ°Ñ‡Ğ° yuvish (3 marta)',ar:'',uz:'',desc:'O\'ng qo\'lni tirsak bo\'g\'imigacha uch marta yuvish, keyin chap qo\'lni. Barmoq uchidan boshlanib tirsak bo\'g\'imiga qadar.'},
  {ico:'ğŸ–ï¸',ttl:'Boshni masÑ… qilish (1 marta)',ar:'',uz:'',desc:'Ho\'l qo\'llar bilan boshni bir marta masÑ… qilish â€” peshonadan orqaga qarab. Hanafiy mazhabida boshning to\'rtdan birini, boshqalarda to\'liq masÑ… qilish.'},
  {ico:'ğŸ‘‚',ttl:'Quloqlarni masÑ… qilish',ar:'',uz:'',desc:'Bosh barmoq bilan quloq orqasini, ko\'rsatkich barmĞ¾q bilan esa quloq ichini masÑ… qilish.'},
  {ico:'ğŸ¦¶',ttl:'Oyoqlarni yuvish (3 marta)',ar:'',uz:'',desc:'O\'ng oyoqni to\'pig\'igacha uch marta yuvish, keyin chap oyoqni. Barmoqlar orasini ham yuvib chiqish lozim.'},
  {ico:'ğŸ¤²',ttl:'Tahorat duosi',ar:'Ø£ÙØ´Ù’Ù‡ÙØ¯Ù Ø£ÙÙ†Ù’ Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„Ù‡Ù ÙˆÙØ£ÙØ´Ù’Ù‡ÙØ¯Ù Ø£ÙÙ†ÙÙ‘ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù‹Ø§ Ø¹ÙØ¨Ù’Ø¯ÙÙ‡Ù ÙˆÙØ±ÙØ³ÙÙˆÙ„ÙÙ‡Ù',uz:'Ashhadu alla ilaha illalloh va ashhadu anna Muhammadan abduhu va rosuluhu',desc:'Tahorat olgandan keyin osmonga qarab bu duoni o\'qish sunnat. Bu duoni o\'qigan kishiga jannatning 8 eshigi ochiladi deyilgan.'},
];

// 5 vaqt namoz ma'lumotlari
const PRAYERS=[
  {
    ico:'ğŸŒ…',name:'Bomdod (Fajr)',sub:'Tong otishidan quyosh chiqqunga qadar',rakat:'2+2 rakat',
    info:'Bomdod namozi 2 rakat sunnat va 2 rakat farzdan iborat. Ular jimgina yoki ovoz chiqarib o\'qilishi mumkin.',
    steps:[
      {ttl:'Sunnat niyati',ar:'Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙØµÙÙ„ÙÙ‘ÙŠ Ø³ÙÙ†ÙÙ‘Ø©Ù Ø§Ù„Ù’ÙÙØ¬Ù’Ø±Ù',tr:'Navaytu usalli sunnatal fajr',uz:'Bomdod namozining sunnatini o\'qishga niyat qildim'},
      {ttl:'Takbiratul ihrom',ar:'Ø§ÙÙ„Ù„Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù',tr:'Allahu Akbar',uz:'Alloh buyuk â€” qo\'llar quloqqa tekizib aytiladi'},
      {ttl:'Sano',ar:'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†ÙÙƒÙ Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ÙˆÙØ¨ÙØ­ÙÙ…Ù’Ø¯ÙÙƒÙ ÙˆÙØªÙØ¨ÙØ§Ø±ÙÙƒÙ Ø§Ø³Ù’Ù…ÙÙƒÙ ÙˆÙØªÙØ¹ÙØ§Ù„ÙÙ‰ Ø¬ÙØ¯ÙÙ‘ÙƒÙ ÙˆÙÙ„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù ØºÙÙŠÙ’Ø±ÙÙƒÙ',tr:'Subhanakallahumma va bihamdik va tabarokasmuk va ta\'ala jadduk va la ilaha gayruk',uz:'Allohim! Men Senga hamd bilan Seni poklayapman. Isming muborak, ulug\'liging baland, Sendan o\'zga iloh yo\'q'},
      {ttl:'A\'uzu Bismillah + Fotiha',ar:'Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ§Ù„Ù„Ù‡Ù Ù…ÙÙ†Ù Ø§Ù„Ø´ÙÙ‘ÙŠÙ’Ø·ÙØ§Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø¬ÙÙŠÙ…Ù Û Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…Ù°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù',tr:'A\'uzu billahi minash-shaytanir rajim. Bismillahir rohmanir rohiym',uz:'Shaytoni rajimdan Allohga panoh so\'rayman. Alloh nomidan boshlayman'},
      {ttl:'Fotiha surasi',ar:'Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…ÙÙŠÙ†Ù Û Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…Ù°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù Û Ù…ÙØ§Ù„ÙÙƒÙ ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ø¯ÙÙ‘ÙŠÙ†Ù Û Ø¥ÙÙŠÙÙ‘Ø§ÙƒÙ Ù†ÙØ¹Ù’Ø¨ÙØ¯Ù ÙˆÙØ¥ÙÙŠÙÙ‘Ø§ÙƒÙ Ù†ÙØ³Ù’ØªÙØ¹ÙÙŠÙ†Ù Û Ø§Ù‡Ù’Ø¯ÙÙ†ÙØ§ Ø§Ù„ØµÙÙ‘Ø±ÙØ§Ø·Ù Ø§Ù„Ù’Ù…ÙØ³Ù’ØªÙÙ‚ÙÙŠÙ…Ù Û ØµÙØ±ÙØ§Ø·Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø£ÙÙ†Ù’Ø¹ÙÙ…Ù’ØªÙ Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ØºÙÙŠÙ’Ø±Ù Ø§Ù„Ù’Ù…ÙØºÙ’Ø¶ÙÙˆØ¨Ù Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ÙˆÙÙ„ÙØ§ Ø§Ù„Ø¶ÙÙ‘Ø§Ù„ÙÙ‘ÙŠÙ†Ù',tr:'Alhamdu lillahi rabbil aalamin, Ar-Rohmanir rohiym, Maliki yawmid-diyn, Iyyaka na\'budu va iyyaka nasta\'yin, Ihdinas siratal mustaqiym, Sirotol laziyna an\'amta alayhim, gayril magdubi alayhim va lad-doolliyn',uz:'Barcha hamdlar olamlar Rabb\'i bo\'lmish Allohga xosdir. Mehribon va rahmdil Allohga. Hisob kunining Egasiga. Faqat Senga ibodat qilamiz va faqat Sendan yordam so\'raymiz. Bizni to\'g\'ri yo\'lga hidoyat qil. O\'zingga ne\'mat bergan zotlarning yo\'liga â€” g\'azabga duchor bo\'lganlar va adashganlarning yo\'liga emas'},
      {ttl:'Qo\'shimcha sura (Ikhlos)',ar:'Ù‚ÙÙ„Ù’ Ù‡ÙÙˆÙ Ø§Ù„Ù„Ù‡Ù Ø£ÙØ­ÙØ¯ÙŒ Û Ø§Ù„Ù„Ù‡Ù Ø§Ù„ØµÙÙ‘Ù…ÙØ¯Ù Û Ù„ÙÙ…Ù’ ÙŠÙÙ„ÙØ¯Ù’ ÙˆÙÙ„ÙÙ…Ù’ ÙŠÙÙˆÙ„ÙØ¯Ù’ Û ÙˆÙÙ„ÙÙ…Ù’ ÙŠÙÙƒÙÙ†Ù’ Ù„ÙÙ‡Ù ÙƒÙÙÙÙˆÙ‹Ø§ Ø£ÙØ­ÙØ¯ÙŒ',tr:'Qul huwallahu ahad, Allahus-Somad, Lam yalid wa lam yuulad, wa lam yakun lahu kufuwan ahad',uz:'Ayting: U â€” Alloh, Yakkayu yolg\'izdir. Alloh â€” barcha muhtoj bo\'lgan zotdir. U tug\'madi va tug\'ilmadi. Va unga hech kim teng bo\'lmadi'},
      {ttl:'Ruku\' (egilish)',ar:'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø±ÙØ¨ÙÙ‘ÙŠÙ Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù Û Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø±ÙØ¨ÙÙ‘ÙŠÙ Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù Û Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø±ÙØ¨ÙÙ‘ÙŠÙ Ø§Ù„Ù’Ø¹ÙØ¸ÙÙŠÙ…Ù',tr:'Subhana Rabbiyal-Aziym (3 marta)',uz:'Ulug\' Rabbim pokdir (3 marta takrorlash)'},
      {ttl:'Qiyom â€” Ruku\'dan turganda',ar:'Ø³ÙÙ…ÙØ¹Ù Ø§Ù„Ù„Ù‡Ù Ù„ÙÙ…ÙÙ†Ù’ Ø­ÙÙ…ÙØ¯ÙÙ‡Ù Û Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ Ù„ÙÙƒÙ Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù',tr:'Sami\'allahu liman hamidah â€” Rabbana lakal hamd',uz:'Alloh uni madh etuvchini eshitdi â€” Robbimiz! Hamd Sengadir'},
      {ttl:'Sajda (1-chi)',ar:'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø±ÙØ¨ÙÙ‘ÙŠÙ Ø§Ù„Ø£ÙØ¹Ù’Ù„ÙÙ‰ Û Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø±ÙØ¨ÙÙ‘ÙŠÙ Ø§Ù„Ø£ÙØ¹Ù’Ù„ÙÙ‰ Û Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø±ÙØ¨ÙÙ‘ÙŠÙ Ø§Ù„Ø£ÙØ¹Ù’Ù„ÙÙ‰',tr:'Subhana Rabbiyal-A\'la (3 marta)',uz:'Buyuk Rabbim pokdir (3 marta)'},
      {ttl:'Jalsa (ikki sajda orasida o\'tirish)',ar:'Ø±ÙØ¨ÙÙ‘ Ø§ØºÙ’ÙÙØ±Ù’ Ù„ÙÙŠ',tr:'Rabbig\'firli',uz:'Robbim! Meni kechir'},
      {ttl:'Sajda (2-chi)',ar:'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø±ÙØ¨ÙÙ‘ÙŠÙ Ø§Ù„Ø£ÙØ¹Ù’Ù„ÙÙ‰ Û Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø±ÙØ¨ÙÙ‘ÙŠÙ Ø§Ù„Ø£ÙØ¹Ù’Ù„ÙÙ‰ Û Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø±ÙØ¨ÙÙ‘ÙŠÙ Ø§Ù„Ø£ÙØ¹Ù’Ù„ÙÙ‰',tr:'Subhana Rabbiyal-A\'la (3 marta)',uz:'Buyuk Robbim pokdir (3 marta) â€” ikkinchi rakat uchun yana Fotiha + sura o\'qiladi'},
      {ttl:'Qa\'da â€” Attahiyyat',ar:'Ø§Ù„ØªÙÙ‘Ø­ÙÙŠÙÙ‘Ø§ØªÙ Ù„ÙÙ„ÙÙ‘Ù‡Ù ÙˆÙØ§Ù„ØµÙÙ‘Ù„ÙÙˆÙØ§ØªÙ ÙˆÙØ§Ù„Ø·ÙÙ‘ÙŠÙÙ‘Ø¨ÙØ§ØªÙ Û Ø§Ù„Ø³ÙÙ‘Ù„ÙØ§Ù…Ù Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙ Ø£ÙÙŠÙÙ‘Ù‡ÙØ§ Ø§Ù„Ù†ÙÙ‘Ø¨ÙÙŠÙÙ‘ ÙˆÙØ±ÙØ­Ù’Ù…ÙØ©Ù Ø§Ù„Ù„Ù‡Ù ÙˆÙØ¨ÙØ±ÙÙƒÙØ§ØªÙÙ‡Ù Û Ø§Ù„Ø³ÙÙ‘Ù„ÙØ§Ù…Ù Ø¹ÙÙ„ÙÙŠÙ’Ù†ÙØ§ ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø¹ÙØ¨ÙØ§Ø¯Ù Ø§Ù„Ù„Ù‡Ù Ø§Ù„ØµÙÙ‘Ø§Ù„ÙØ­ÙÙŠÙ†Ù Û Ø£ÙØ´Ù’Ù‡ÙØ¯Ù Ø£ÙÙ†Ù’ Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„Ù‡Ù ÙˆÙØ£ÙØ´Ù’Ù‡ÙØ¯Ù Ø£ÙÙ†ÙÙ‘ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù‹Ø§ Ø¹ÙØ¨Ù’Ø¯ÙÙ‡Ù ÙˆÙØ±ÙØ³ÙÙˆÙ„ÙÙ‡Ù',tr:'Attahiyyatu lillahi vas-salavatu vat-tayyibat, Assalamu alayka ayyuhan-Nabiyyu va rahmatullahi va barakatuh, Assalamu alayna va ala ibadillahis-salihin, Ashhadu alla ilaha illalloh va ashhadu anna Muhammadan abduhu va rosuluh',uz:'Barcha ta\'zimlar, ibodatlar va pokliklar Allohga tegishlidir. Ey Nabiy! Sening ustingda Allohning salomi, rahmati va barakasi bo\'lsin. Bizga va Allohning solih bandalariga salom bo\'lsin. Allohdan boshqa iloh yo\'qligiga va Muhammadning Uning bandi va elchisi ekanligiga guvohlik beraman'},
      {ttl:'Salom berish',ar:'Ø§Ù„Ø³ÙÙ‘Ù„ÙØ§Ù…Ù Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙÙ…Ù’ ÙˆÙØ±ÙØ­Ù’Ù…ÙØ©Ù Ø§Ù„Ù„Ù‡Ù',tr:'Assalamu alaykum wa rohmatulloh',uz:'O\'ng tomonga, keyin chap tomonga salom berish. 2 rakat sunnat tamom. Endi 2 rakat farz o\'qiladi â€” farz niyati bilan.'},
    ]
  },
  {
    ico:'â˜€ï¸',name:'Peshin (Zuhr)',sub:'Quyosh tepasidan og\'ishidan Asr vaqtigacha',rakat:'4+4+2+2 rakat',
    info:'Peshin namozi: 4 rakat sunnat, 4 rakat farz, 2 rakat sunnat, 2 rakat nafl. Eng ko\'p rakatli namoz.',
    steps:[
      {ttl:'Niyat â€” 4 rakat sunnat',ar:'Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙØµÙÙ„ÙÙ‘ÙŠ Ø³ÙÙ†ÙÙ‘Ø©Ù Ø§Ù„Ø¸ÙÙ‘Ù‡Ù’Ø±Ù',tr:'Navaytu usalli sunnatal zuhr',uz:'Peshin sunnatini o\'qishga niyat qildim'},
      {ttl:'Takbiratul ihrom',ar:'Ø§ÙÙ„Ù„Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù',tr:'Allahu Akbar',uz:'Qo\'llar quloqqa tekizib aytiladi. Qo\'llar qorin ustiga qo\'yiladi'},
      {ttl:'Sano + Fotiha + Sura (1-rakat)',ar:'',tr:'',uz:'Sano o\'qiladi â†’ A\'uzu Bismillah â†’ Fotiha â†’ qo\'shimcha sura (Ikhlos yoki boshqa)'},
      {ttl:'Ruku\', Sajda, 2-rakat',ar:'',tr:'',uz:'1-rakat kabi. 2-rakatdan keyin Attahiyyat (qa\'da) o\'qiladi'},
      {ttl:'3-rakat va 4-rakat',ar:'',tr:'',uz:'3 va 4-rakatda faqat Fotiha o\'qiladi (sura qo\'shilmaydi). Oxirida Attahiyyat, Salovat, Du\'o, Salom'},
      {ttl:'Salovat duosi',ar:'Ø§ÙÙ„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ØµÙÙ„ÙÙ‘ Ø¹ÙÙ„ÙÙ‰ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø¢Ù„Ù Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù ÙƒÙÙ…ÙØ§ ØµÙÙ„ÙÙ‘ÙŠÙ’ØªÙ Ø¹ÙÙ„ÙÙ‰ Ø¥ÙØ¨Ù’Ø±ÙØ§Ù‡ÙÙŠÙ…Ù ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø¢Ù„Ù Ø¥ÙØ¨Ù’Ø±ÙØ§Ù‡ÙÙŠÙ…Ù Ø¥ÙÙ†ÙÙ‘ÙƒÙ Ø­ÙÙ…ÙÙŠØ¯ÙŒ Ù…ÙØ¬ÙÙŠØ¯ÙŒ',tr:'Allohumma solli ala Muhammadin va ala ali Muhammadin kama sollayta ala Ibrohima va ala ali Ibrohim, innaka hamidun majid',uz:'Allohim! Ibrohim va uning avlodiga salovat yuborganingdek, Muhammadga va uning avlodiga ham salovat yuborgin. Albatta Sen hamdga loyiq va ulug\' zotsan'},
      {ttl:'4 rakat farz niyati',ar:'Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙØµÙÙ„ÙÙ‘ÙŠ ÙÙØ±Ù’Ø¶Ù Ø§Ù„Ø¸ÙÙ‘Ù‡Ù’Ø±Ù',tr:'Navaytu usalli fardal zuhr',uz:'Peshin namozining farzini o\'qishga niyat qildim. Farz ham xuddi sunnat kabi o\'qiladi'},
    ]
  },
  {
    ico:'ğŸŒ¤ï¸',name:'Asr',sub:'Peshin vaqti tugagandan Quyosh botgunga qadar',rakat:'4+4 rakat',
    info:'Asr namozi: 4 rakat sunnat va 4 rakat farzdan iborat. Qur\'onda alohida ta\'kidlangan namoz.',
    steps:[
      {ttl:'Niyat â€” 4 rakat sunnat',ar:'Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙØµÙÙ„ÙÙ‘ÙŠ Ø³ÙÙ†ÙÙ‘Ø©Ù Ø§Ù„Ù’Ø¹ÙØµÙ’Ø±Ù',tr:'Navaytu usalli sunnatal Asr',uz:'Asr sunnatini o\'qishga niyat qildim'},
      {ttl:'4 rakat o\'qish',ar:'',tr:'',uz:'Peshin namozidagi 4 rakat kabi o\'qiladi. 1-2 rakatda Fotiha+Sura, 3-4 rakatda faqat Fotiha'},
      {ttl:'4 rakat farz',ar:'Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙØµÙÙ„ÙÙ‘ÙŠ ÙÙØ±Ù’Ø¶Ù Ø§Ù„Ù’Ø¹ÙØµÙ’Ø±Ù',tr:'Navaytu usalli fardal Asr',uz:'Asr farzini o\'qishga niyat qildim'},
      {ttl:'Qasr namozi (musofir)',ar:'',tr:'',uz:'Safarda (44 km dan ortiq) bo\'lsa, Peshin va Asr namozlarining farzi 2 rakatga qisqaradi'},
    ]
  },
  {
    ico:'ğŸŒ†',name:'Shom (Mag\'rib)',sub:'Quyosh botishidan Shafaq yo\'qolgunga qadar',rakat:'3+2+2 rakat',
    info:'Shom namozi: 3 rakat farz, 2 rakat sunnat, 2 rakat nafl. Qisqa vaqtli, o\'qishni kechiktirmaslik kerak.',
    steps:[
      {ttl:'3 rakat farz niyati',ar:'Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙØµÙÙ„ÙÙ‘ÙŠ ÙÙØ±Ù’Ø¶Ù Ø§Ù„Ù’Ù…ÙØºÙ’Ø±ÙØ¨Ù',tr:'Navaytu usalli fardal Mag\'rib',uz:'Shom namozining farzini o\'qishga niyat qildim'},
      {ttl:'1-rakat: Fotiha + Sura',ar:'',tr:'',uz:'Takbir â†’ Sano â†’ Fotiha â†’ Sura (Ikhlos) â†’ Ruku â†’ 2 Sajda'},
      {ttl:'2-rakat: Fotiha + Sura + Qa\'da',ar:'',tr:'',uz:'Fotiha â†’ Sura â†’ Ruku â†’ 2 Sajda â†’ O\'tirib Attahiyyat o\'qiladi'},
      {ttl:'3-rakat: Fatiha',ar:'',tr:'',uz:'3-rakatda faqat Fotiha o\'qiladi, Sura qo\'shilmaydi â†’ Ruku â†’ 2 Sajda â†’ Attahiyyat â†’ Salovat â†’ Salom'},
      {ttl:'2 rakat sunnat',ar:'Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙØµÙÙ„ÙÙ‘ÙŠ Ø³ÙÙ†ÙÙ‘Ø©Ù Ø§Ù„Ù’Ù…ÙØºÙ’Ø±ÙØ¨Ù',tr:'Navaytu usalli sunnatal Mag\'rib',uz:'Shom sunnatini o\'qishga niyat qildim. 2 rakat o\'qiladi'},
    ]
  },
  {
    ico:'ğŸŒ™',name:'Xufton (Isha)',sub:'Shafaq yo\'qolishidan Tong otgunga qadar',rakat:'4+4+2+2+3 rakat',
    info:'Xufton namozi: 4 rakat sunnat, 4 rakat farz, 2 rakat sunnat, 2 rakat nafl, 3 rakat Vitr. Eng to\'liq namoz.',
    steps:[
      {ttl:'4 rakat sunnat',ar:'Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙØµÙÙ„ÙÙ‘ÙŠ Ø³ÙÙ†ÙÙ‘Ø©Ù Ø§Ù„Ù’Ø¹ÙØ´ÙØ§Ø¡Ù',tr:'Navaytu usalli sunnatal Isha',uz:'Xufton sunnatini o\'qishga niyat qildim'},
      {ttl:'4 rakat farz',ar:'Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙØµÙÙ„ÙÙ‘ÙŠ ÙÙØ±Ù’Ø¶Ù Ø§Ù„Ù’Ø¹ÙØ´ÙØ§Ø¡Ù',tr:'Navaytu usalli fardal Isha',uz:'Xufton farzini o\'qishga niyat qildim. 4 rakat â€” peshin kabi'},
      {ttl:'2 rakat sunnat + 2 nafl',ar:'',tr:'',uz:'Yana 2 rakat sunnat, so\'ngra 2 rakat nafl o\'qilishi mumkin'},
      {ttl:'3 rakat Vitr',ar:'Ù†ÙÙˆÙÙŠÙ’ØªÙ Ø£ÙØµÙÙ„ÙÙ‘ÙŠ Ø§Ù„Ù’ÙˆÙØªÙ’Ø±Ù',tr:'Navaytu usallas vitr',uz:'3 rakat vitr niyati. 1-2 rakat o\'qiladi â†’ Attahiyyat â†’ 3-rakatda Fotiha+Sura+Qunut duosi'},
      {ttl:'Qunut duosi (Vitr)',ar:'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘Ø§ Ù†ÙØ³Ù’ØªÙØ¹ÙÙŠÙ†ÙÙƒÙ ÙˆÙÙ†ÙØ³Ù’ØªÙØºÙ’ÙÙØ±ÙÙƒÙ ÙˆÙÙ†ÙØ³Ù’ØªÙÙ‡Ù’Ø¯ÙÙŠÙƒÙ ÙˆÙÙ†ÙØ¤Ù’Ù…ÙÙ†Ù Ø¨ÙÙƒÙ ÙˆÙÙ†ÙØªÙÙˆÙÙƒÙÙ‘Ù„Ù Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙ ÙˆÙÙ†ÙØ«Ù’Ù†ÙÙŠ Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙ Ø§Ù„Ù’Ø®ÙÙŠÙ’Ø±Ù',tr:'Allohumma inna nasta\'inuka va nastagfiruka va nastahdiyk va nu\'minu bika va natawakkalu alayk va nusni alaykal-khayr',uz:'Allohim! Senga sig\'inyapmiz, Seningdan mag\'firat so\'raymiz, hidoyat so\'raymiz, Senga imon keltiramiz, Senga tayanamiz, Seni yaxshilik bilan maqtaymiz'},
    ]
  }
];

let activeNTab=0;

function nTab(i){
  activeNTab=i;
  [0,1].forEach(j=>document.getElementById('nc'+j).classList.toggle('on',j===i));
  renderNamoz();
}

function renderNamoz(){
  const el=document.getElementById('ncontent');el.innerHTML='';
  if(activeNTab===0){renderTahorat(el);}else{renderPrayers(el);}
}

function stepCard(icon,num,title,ar,uz,desc){
  const d=document.createElement('div');d.className='nstep';
  d.innerHTML=`<div class="nstep-hd">
    <div class="nstep-num">${num}</div>
    <div class="nstep-ico">${icon}</div>
    <div class="nstep-ttl">${title}</div>
    <div class="nstep-arr">â–¼</div>
  </div>
  <div class="nstep-body"><div class="nstep-inner">
    ${ar?`<div class="nstep-ar">${ar}</div>`:''}
    ${uz?`<div class="nstep-uz">ğŸ“– ${uz}</div>`:''}
    ${desc?`<div class="nstep-desc">â„¹ï¸ ${desc}</div>`:''}
  </div></div>`;
  d.querySelector('.nstep-hd').onclick=()=>d.classList.toggle('open');
  return d;
}

function renderTahorat(el){
  const title=document.createElement('div');title.className='nsectitle';title.innerHTML='ğŸ’§ Tahorat olish tartibi';el.appendChild(title);
  const info=document.createElement('div');info.className='ninfo';
  info.innerHTML='<b>Tahorat</b> â€” namoz o\'qish uchun shart bo\'lgan poklik holati. <b>Tahoratni buzuvchi holatlar:</b> hojatga borish, yel chiqarish, qon oqishi, behush bo\'lish, uxlash.';
  el.appendChild(info);
  TAHORAT.forEach((s,i)=>el.appendChild(stepCard(s.ico,i+1,s.ttl,s.ar,s.uz,s.desc)));
}

function renderPrayers(el){
  const title=document.createElement('div');title.className='nsectitle';title.innerHTML='ğŸ•Œ 5 Vaqt Namoz';el.appendChild(title);
  const info=document.createElement('div');info.className='ninfo';
  info.innerHTML='<b>5 vaqt namoz</b> har bir musulmon uchun farzdĞ¸Ñ€. <b>Niyat</b> qilib, <b>Qibla</b>ga qarab, <b>tahorat</b> bilan o\'qiladi.';
  el.appendChild(info);
  PRAYERS.forEach(p=>{
    const d=document.createElement('div');d.className='nprayer';
    d.innerHTML=`<div class="nprayer-hd">
      <div class="nprayer-ico">${p.ico}</div>
      <div class="nprayer-info">
        <div class="nprayer-name">${p.name}</div>
        <div class="nprayer-sub">${p.sub}</div>
      </div>
      <div class="nprayer-rakat">${p.rakat}</div>
      <div class="nprayer-arr">â–¼</div>
    </div>
    <div class="nprayer-body"><div class="nprayer-inner">
      <div class="ninfo">${p.info}</div>
      ${p.steps.map((s,i)=>`<div class="nrak">
        <div class="nrak-num">${i+1}</div>
        <div class="nrak-cont">
          <div class="nrak-ttl">${s.ttl}</div>
          ${s.ar?`<div class="nrak-ar">${s.ar}</div>`:''}
          ${s.tr?`<div class="nrak-tr">${s.tr}</div>`:''}
          ${s.uz?`<div class="nrak-uz">${s.uz}</div>`:''}
        </div>
      </div>`).join('')}
    </div></div>`;
    d.querySelector('.nprayer-hd').onclick=()=>d.classList.toggle('open');
    el.appendChild(d);
  });
}

/* â•â• BOOT â•â• */
buildRec();renderList(SURAHS);renderNamoz();

window.addEventListener('DOMContentLoaded',()=>{
  if(window.Telegram?.WebApp){const tg=Telegram.WebApp;tg.ready();tg.expand();tg.setHeaderColor?.('#0a0f1a');tg.setBackgroundColor?.('#0a0f1a');}
  updateQibla();setLocUI(userLat,userLon,"Toshkent, O'zbekiston");
  requestAnimationFrame(qLoop);
  startGPS();
  if(isIOS()){
    showBtn('Kompasni ishlatish uchun qurilma ruxsatini bering','ğŸ“ Ruxsat berish',()=>{
      document.getElementById('qpbtn').style.display='none';setLoadMsg('Ruxsat so\'ralmoqda...');requestSensor();
    });
  } else {
    requestSensor();
  }
});
</script>
</body>
</html>
